router = ->
  route = location.hash[1..]
  [endpoint, params...] = route.split('/')[1..]
  switch endpoint
    when 'home' then renderHome params
    when 'profile' then renderProfile params
    when 'edit' then renderEdit params
    when 'view' then renderView params
    when '404' then renderNotFound params
  $('textarea').autosize()
  return

renderNotFound = (params) ->
  templateSource = $("#not-found-template").html()
  template = Handlebars.compile templateSource
  $('#container').html template()

renderHome = (params) ->
  templateSource = $("#home-template").html()
  template = Handlebars.compile templateSource
  $('#container').html template({
    username: 'profile'
    is_logged_in: true
  })

fakeProfileData =
  name: 'Tom Shen'
  username: 'tomshen'
  avatar_url: 'https://avatars0.githubusercontent.com/u/2065456?v=2&s=460'
  is_owner: true
  tutorials: [
    {
      title: 'JavaScript Quirks'
      description: 'Super duper weird things about JavaScript you should know'
      url: '#/view/javascriptquirks'
    }
    {
      title: 'CSS Tricks'
      description: 'Handy dandy CSS tricks that you can use in your next website'
      url: '#/view/csstricks'
    }
  ]

renderProfile = (params) ->
  templateSource = $("#profile-template").html()
  template = Handlebars.compile templateSource
  $('#container').html template(fakeProfileData)

fakeTutorialData =
  user: {
    name: 'Tom Shen'
    username: 'tomshen'
  }
  is_owner: true
  title: 'JavaScript Quirks'

  steps: [
    {
      title: 'Undefined vs null'
      content_before: 'Use null in your code'
      content_after: 'Undefined is used to show absence of value, not null values'
      diff:
        diff_url: 'https://github.com/bezi/gitorial/commit/d5f43a7a3f4b3cacfc0fea98751e70f65c9da79d'
        code_url: 'https://github.com/bezi/gitorial/tree/d5f43a7a3f4b3cacfc0fea98751e70f65c9da79d'
        files: [{"name": "/gitorial/coffee/main.coffee", "chunks": [[{"old_number": 3, "new_number": 3, "content": ""}, {"old_number": 4, "new_number": 4, "content": ""}, {"old_number": 5, "new_number": 5, "content": "gitorial = {};"}, {"old_number": 6, "new_number": 6, "content": ""}, {"content": "# Session", "new_number": 7, "addition": true, "whitespace": ""}, {"content": "gitorial.session = null", "new_number": 8, "addition": true, "whitespace": ""}, {"content": "gitorial.updateSession = ->", "new_number": 9, "addition": true, "whitespace": ""}, {"content": "address = \"/session\"", "new_number": 10, "addition": true, "whitespace": "&nbsp;&nbsp;&nbsp;&nbsp;"}, {"content": "$.getJSON address, (data) ->", "new_number": 11, "addition": true, "whitespace": "&nbsp;&nbsp;&nbsp;&nbsp;"}, {"content": "gitorial.session = data;", "new_number": 12, "addition": true, "whitespace": "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}, {"content": "", "new_number": 13, "addition": true, "whitespace": ""}, {"old_number": 7, "new_number": 14, "content": "# Templating"}, {"old_number": 8, "new_number": 15, "content": "gitorial.templates ="}, {"old_number": 9, "new_number": 16, "content": "profile: Handlebars.compile $(\"#profile-template\").html()"}], [{"old_number": 14, "new_number": 21, "content": "gitorial.templates ="}, {"old_number": 15, "new_number": 22, "content": "gitorial.routes ="}, {"old_number": 16, "new_number": 23, "content": "profile: (params) ->"}, {"old_number": 17, "new_number": 24, "content": "address = '/api/' + params[0]"}, {"old_number": 18, "deletion": true, "content": "console.log \"profile:\", address", "whitespace": "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}, {"old_number": 19, "new_number": 25, "content": "$.getJSON address, (data) ->"}, {"old_number": 20, "deletion": true, "content": "console.log data", "whitespace": "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}, {"old_number": 21, "new_number": 26, "content": "$('#container').html gitorial.templates.profile(data)"}, {"old_number": 22, "new_number": 27, "content": ""}, {"old_number": 23, "new_number": 28, "content": "edit: (params) ->"}, {"old_number": 24, "new_number": 29, "content": "address = '/api/' + params[0] + '/' + params[1]"}, {"old_number": 25, "deletion": true, "content": "console.log \"edit:\", address", "whitespace": "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}, {"old_number": 26, "new_number": 30, "content": "$.getJSON address, (data) ->"}, {"old_number": 27, "deletion": true, "content": "console.log data", "whitespace": "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}, {"old_number": 28, "new_number": 31, "content": "$('#container').html gitorial.templates.edit(data)"}, {"old_number": 29, "new_number": 32, "content": ""}, {"old_number": 30, "new_number": 33, "content": "view: (params) ->"}, {"old_number": 31, "new_number": 34, "content": "address = '/api/' + params[0] + '/' + params[1]"}, {"old_number": 32, "new_number": 35, "content": "$.getJSON address, (data) ->"}, {"old_number": 33, "deletion": true, "content": "console.log data", "whitespace": "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}, {"old_number": 34, "new_number": 36, "content": "$('#container').html gitorial.templates.view(data)"}, {"old_number": 35, "new_number": 37, "content": ""}, {"old_number": 36, "new_number": 38, "content": "home: ->"}, {"old_number": 37, "new_number": 39, "content": ""}]]}, {"name": "/gitorial/static/css/style.css", "chunks": [[{"old_number": 17, "new_number": 17, "content": "a {"}, {"old_number": 18, "new_number": 18, "content": "text-decoration: none;"}, {"old_number": 19, "new_number": 19, "content": "}"}, {"old_number": 20, "new_number": 20, "content": "a:hover {"}, {"old_number": 21, "deletion": true, "content": "color: #FF4136;", "whitespace": "&nbsp;&nbsp;"}, {"content": "color: #0074D9;", "new_number": 21, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"old_number": 22, "new_number": 22, "content": "}"}, {"old_number": 23, "new_number": 23, "content": ""}, {"old_number": 24, "new_number": 24, "content": "h1, h2, h3, h4, h5, h6 {"}], [{"old_number": 25, "new_number": 25, "content": "h1, h2, h3, h4, h5, h6 {"}, {"old_number": 26, "new_number": 26, "content": "}"}, {"old_number": 27, "new_number": 27, "content": ""}, {"old_number": 28, "new_number": 28, "content": ".gitorial-header {"}, {"content": "border: none;", "new_number": 29, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"old_number": 29, "new_number": 30, "content": "color: #444;"}, {"old_number": 30, "new_number": 31, "content": "font-family: Raleway, sans-serif"}, {"old_number": 31, "new_number": 32, "content": "font-weight: 300;"}], [{"old_number": 42, "new_number": 43, "content": "h1, h2, h3, h4, h5, h6 {"}, {"old_number": 43, "new_number": 44, "content": "}"}, {"old_number": 44, "new_number": 45, "content": ""}, {"old_number": 45, "new_number": 46, "content": ".button {"}, {"old_number": 46, "deletion": true, "content": "border: 0.15rem solid #333;", "whitespace": "&nbsp;&nbsp;"}, {"content": "border: 0.25rem solid #333;", "new_number": 47, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"old_number": 47, "new_number": 48, "content": "border-radius: 1rem;"}, {"old_number": 48, "new_number": 49, "content": "moz-border-radius: 1rem;"}, {"old_number": 49, "new_number": 50, "content": "-webkit-border-radius: 1rem;"}], [{"old_number": 99, "new_number": 100, "content": "h1, h2, h3, h4, h5, h6 {"}, {"old_number": 100, "new_number": 101, "content": "margin: 0;"}, {"old_number": 101, "new_number": 102, "content": "width: 85%;"}, {"old_number": 102, "new_number": 103, "content": "}"}, {"content": ".sign-in-button:hover {", "new_number": 104, "addition": true, "whitespace": ""}, {"content": "border-color: #0074D9;", "new_number": 105, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "color: #0074D9;", "new_number": 106, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "opacity: 1;", "new_number": 107, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "}", "new_number": 108, "addition": true, "whitespace": ""}, {"old_number": 103, "new_number": 109, "content": ""}, {"old_number": 104, "new_number": 110, "content": "/* Profile */"}, {"old_number": 105, "new_number": 111, "content": ".profile-page {"}], [{"old_number": 129, "new_number": 135, "content": "h1, h2, h3, h4, h5, h6 {"}, {"old_number": 130, "new_number": 136, "content": "margin: 0 auto;"}, {"old_number": 131, "new_number": 137, "content": "width: 200px;"}, {"old_number": 132, "new_number": 138, "content": "}"}, {"old_number": 133, "deletion": true, "content": ".new-tutorial-button {", "whitespace": ""}, {"content": ".user-info > .button {", "new_number": 139, "addition": true, "whitespace": ""}, {"old_number": 134, "new_number": 140, "content": "display: block;"}, {"old_number": 135, "new_number": 141, "content": "font-size: 0.8rem;"}, {"old_number": 136, "new_number": 142, "content": "margin: 1rem auto;"}, {"old_number": 137, "new_number": 143, "content": "padding: 0.25rem;"}, {"old_number": 138, "new_number": 144, "content": "width: 75%;"}, {"old_number": 139, "new_number": 145, "content": "}"}, {"content": ".new-tutorial-button {", "new_number": 146, "addition": true, "whitespace": ""}, {"content": "border-color: #0074D9;", "new_number": 147, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "color: #0074D9;", "new_number": 148, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "}", "new_number": 149, "addition": true, "whitespace": ""}, {"content": ".new-tutorial-button:hover {", "new_number": 150, "addition": true, "whitespace": ""}, {"content": "color: #0074D9;", "new_number": 151, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "}", "new_number": 152, "addition": true, "whitespace": ""}, {"content": ".sign-out-button {", "new_number": 153, "addition": true, "whitespace": ""}, {"content": "border-color: #FF4136;", "new_number": 154, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "color: #FF4136;", "new_number": 155, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "}", "new_number": 156, "addition": true, "whitespace": ""}, {"content": ".sign-out-button:hover {", "new_number": 157, "addition": true, "whitespace": ""}, {"content": "color: #FF4136;", "new_number": 158, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "}", "new_number": 159, "addition": true, "whitespace": ""}, {"old_number": 140, "new_number": 160, "content": ""}, {"old_number": 141, "new_number": 161, "content": ".tutorials {"}, {"old_number": 142, "new_number": 162, "content": "float: right;"}], [{"old_number": 201, "new_number": 221, "content": "textarea {"}, {"old_number": 202, "new_number": 222, "content": "border: 0.05rem dashed #BBB;"}, {"old_number": 203, "new_number": 223, "content": "width: 100%;"}, {"old_number": 204, "new_number": 224, "content": "}"}, {"content": "textarea.tutorial-title {", "new_number": 225, "addition": true, "whitespace": ""}, {"content": "width: 90%;", "new_number": 226, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "}", "new_number": 227, "addition": true, "whitespace": ""}, {"content": "", "new_number": 228, "addition": true, "whitespace": ""}, {"content": ".tutorial-delete-button {", "new_number": 229, "addition": true, "whitespace": ""}, {"content": "border: none;", "new_number": 230, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "color: inherit;", "new_number": 231, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "float: right;", "new_number": 232, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "font-size: 4rem;", "new_number": 233, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "}", "new_number": 234, "addition": true, "whitespace": ""}, {"content": ".tutorial-delete-button:hover {", "new_number": 235, "addition": true, "whitespace": ""}, {"content": "color: #FF4136;", "new_number": 236, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "}", "new_number": 237, "addition": true, "whitespace": ""}, {"old_number": 205, "new_number": 238, "content": ""}, {"old_number": 206, "new_number": 239, "content": ".tutorial-generate-button {"}, {"content": "border-color: #0074D9;", "new_number": 240, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "color: #0074D9;", "new_number": 241, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"old_number": 207, "new_number": 242, "content": "display: block;"}, {"old_number": 208, "new_number": 243, "content": "font-size: 2rem;"}, {"old_number": 209, "new_number": 244, "content": "margin: 2rem auto;"}, {"old_number": 210, "new_number": 245, "content": "text-align: center;"}, {"old_number": 211, "new_number": 246, "content": "width: 300px;"}, {"old_number": 212, "new_number": 247, "content": "}"}, {"content": ".tutorial-generate-button:hover {", "new_number": 248, "addition": true, "whitespace": ""}, {"content": "color: #0074D9;", "new_number": 249, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "}", "new_number": 250, "addition": true, "whitespace": ""}, {"old_number": 213, "new_number": 251, "content": ""}, {"old_number": 214, "new_number": 252, "content": "/* View */"}, {"old_number": 215, "new_number": 253, "content": ".tutorial-edit-button {"}, {"old_number": 216, "new_number": 254, "content": "border: none;"}, {"content": "color: inherit;", "new_number": 255, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"old_number": 217, "new_number": 256, "content": "float: right;"}, {"old_number": 218, "new_number": 257, "content": "font-size: 4rem;"}, {"old_number": 219, "new_number": 258, "content": "}"}, {"content": ".tutorial-edit-button:hover {", "new_number": 259, "addition": true, "whitespace": ""}, {"content": "color: #0074D9;", "new_number": 260, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"content": "}", "new_number": 261, "addition": true, "whitespace": ""}, {"old_number": 220, "new_number": 262, "content": ""}, {"old_number": 221, "new_number": 263, "content": "/* Code */"}, {"old_number": 222, "new_number": 264, "content": ".step-code {"}], [{"old_number": 404, "new_number": 446, "content": "code {"}, {"old_number": 405, "new_number": 447, "content": "width: 200px;"}, {"old_number": 406, "new_number": 448, "content": "}"}, {"old_number": 407, "new_number": 449, "content": ""}, {"old_number": 408, "deletion": true, "content": ".tutorial-edit-button {", "whitespace": "&nbsp;&nbsp;"}, {"content": ".tutorial-delete-button, .tutorial-edit-button {", "new_number": 450, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"old_number": 409, "new_number": 451, "content": "font-size: 2rem;"}, {"old_number": 410, "new_number": 452, "content": "}"}, {"old_number": 411, "new_number": 453, "content": "}"}, {"old_number": 412, "new_number": 454, "content": ""}]]}, {"name": "/gitorial/templates/index.html", "chunks": [[{"old_number": 58, "new_number": 58, "content": ""}, {"old_number": 59, "new_number": 59, "content": "</a>"}, {"old_number": 60, "new_number": 60, "content": "{{#if is_owner}}"}, {"old_number": 61, "new_number": 61, "content": "<a href=\"#\" class=\"button new-tutorial-button\"><i class=\"fa fa-plus-circle\"></i>&nbsp;Create new tutorial</a>"}, {"content": "", "new_number": 62, "addition": true, "whitespace": ""}, {"content": "<a href=\"#\" class=\"button sign-out-button\"><i class=\"fa fa-sign-out\"></i>&nbsp;Sign out</a>", "new_number": 63, "addition": true, "whitespace": "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}, {"old_number": 62, "new_number": 64, "content": "{{/if}}"}, {"old_number": 63, "new_number": 65, "content": "</section>"}, {"old_number": 64, "new_number": 66, "content": "<section class=\"tutorials\">"}], [{"old_number": 89, "new_number": 91, "content": ""}, {"old_number": 90, "new_number": 92, "content": "</a>"}, {"old_number": 91, "new_number": 93, "content": "</span>"}, {"old_number": 92, "new_number": 94, "content": "</header>"}, {"old_number": 93, "deletion": true, "content": "<textarea rows=1 class=\"tutorial-title\">{{title}}</textarea>", "whitespace": "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}, {"content": "<header>", "new_number": 95, "addition": true, "whitespace": "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}, {"content": "<textarea rows=1 class=\"tutorial-title\">{{title}}</textarea>", "new_number": 96, "addition": true, "whitespace": "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}, {"content": "<a href=\"#\" class=\"tutorial-delete-button\"><i class=\"fa fa-trash-o\"></i></a>", "new_number": 97, "addition": true, "whitespace": "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}, {"content": "</header>", "new_number": 98, "addition": true, "whitespace": "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}, {"old_number": 94, "new_number": 99, "content": "{{#each steps}}"}, {"old_number": 95, "new_number": 100, "content": "<section class=\"tutorial-step\">"}, {"old_number": 96, "new_number": 101, "content": "<h1>"}], [{"old_number": 174, "new_number": 179, "content": "<h1 class=\"step-title\">{{title}}</h1>"}, {"old_number": 175, "new_number": 180, "content": "</article>"}, {"old_number": 176, "new_number": 181, "content": "</script>"}, {"old_number": 177, "new_number": 182, "content": "<script src=\"//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js\"></script>"}, {"content": "<script src=\"//cdnjs.cloudflare.com/ajax/libs/autosize.js/1.18.4/jquery.autosize.min.js\"></script>", "new_number": 183, "addition": true, "whitespace": "&nbsp;&nbsp;"}, {"old_number": 178, "new_number": 184, "content": "<script src=\"//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.4/handlebars.min.js\"></script>"}, {"old_number": 179, "new_number": 185, "content": "<script src=\"assets/js/main.js\"></script>"}, {"old_number": 180, "new_number": 186, "content": "</body>"}, {"old_number": 181, "new_number": 187, "content": ""}]]}]
    }
    {
      title: '=== vs =='
      content_before: '== is incredibly inconsistent. Never use it.'
      content_after: 'Always use ===, since it will never implicitly do type conversion.'
    }
  ]

renderEdit = (params) ->
  templateSource = $("#edit-template").html()
  template = Handlebars.compile templateSource
  $('#container').html template(fakeTutorialData)

renderView = (params) ->
  templateSource = $("#view-template").html()
  template = Handlebars.compile templateSource
  $('#container').html template(fakeTutorialData)

$(window).on 'hashchange', router



if '#' in location.hash
  router()
